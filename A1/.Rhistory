knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
setwd("/Users/yuehan/Desktop/Duke/21Spring/Econ613/Assignments/A1/dat")
if (!("data" %in% ls())) {
data <- map(dir(),read.csv)
}
names(data) <- str_replace(dir(),".csv","")
setwd("/Users/yuehan/Desktop/Duke/21Spring/hw")
data$datstu %>% nrow()
data$datsss %>% select(schoolcode) %>% distinct() %>% nrow()
choices_school <- data$datstu %>%
select(X,schoolcode1:schoolcode6,rankplace, score,jssdistrict) %>%
pivot_longer(schoolcode1:schoolcode6, names_to = "choice", values_to = "school") %>%
mutate(choice = str_extract(choice,"[0-9]"))
choices_school %>% select(school) %>% distinct() %>% drop_na() %>% nrow()
View(data)
View(data)
setwd("/Users/yuehan/Desktop/Duke/21Spring/Econ613/Assignments/A1/dat")
if (!("data" %in% ls())) {
data <- map(dir(),read.csv)
}
names(data) <- str_replace(dir(),".csv","")
setwd("/Users/yuehan/Desktop/Duke/21Spring/hw")
data$datstu %>% nrow()
data$datsss %>% select(schoolcode) %>% distinct() %>% nrow()
choices_school <- data$datstu %>%
select(X,schoolcode1:schoolcode6,rankplace, score,jssdistrict) %>%
pivot_longer(schoolcode1:schoolcode6, names_to = "choice", values_to = "school") %>%
mutate(choice = str_extract(choice,"[0-9]"))
choices_school %>% select(school) %>% distinct() %>% drop_na() %>% nrow()
choices_program <- data$datstu %>%
select(X,choicepgm1:choicepgm6) %>%
pivot_longer(choicepgm1:choicepgm6, names_to = "choice", values_to = "program") %>%
mutate(choice = str_extract(choice,"[0-9]"))
choices_program %>% select(program) %>% distinct() %>% filter(program != "") %>% nrow()
choices <- merge(choices_program, choices_school, by=c("X", "choice"))
choices %>% select(program,school) %>% distinct() %>% drop_na() %>% filter(program != "") %>% nrow()
schools <- data$datsss %>%
select(-c(X,schoolname)) %>%
distinct() %>%
drop_na()
admitted <- choices %>%
drop_na() %>%
filter(rankplace == choice) %>%
merge(schools,by.x="school",by.y="schoolcode", all.x=TRUE) %>%
select(X,school, program, rankplace,score, sssdistrict, ssslong, ssslat, jssdistrict)
admitted_summary <- admitted %>%
select(school, program, sssdistrict, ssslong, ssslat, score) %>%
group_by(school, program, sssdistrict, ssslong, ssslat) %>%
dplyr::summarise(cutoff = min(score),
quality = mean(score),
size = n(),.groups="drop")
admitted_summary %>% head(20)
school_distance %>% head(20)
dis <- function(ssslong,ssslat,jsslong,jsslat){
d <- sqrt((69.172*(ssslong-jsslong)*cos(jsslat/57.3))^2 + (69.172*(ssslat-jsslat))^2)
return(d)
}
school_distance <- admitted %>%
merge(select(data$datjss,-X), by="jssdistrict", all.x = TRUE) %>%
mutate(distance = dis(ssslong, ssslat, point_x, point_y))
school_distance %>% head(20)
View(school_distance)
school_distance %>% select(X,jssdistrict,ssssdistrict,distance) %>% head(20)
school_distance %>% select(X,jssdistrict,sssdistrict,distance) %>% head(20)
setwd("/Users/yuehan/Desktop/Duke/21Spring/Econ613/Assignments/A1/dat")
if (!("data" %in% ls())) {
data <- map(dir(),read.csv)
}
names(data) <- str_replace(dir(),".csv","")
setwd("/Users/yuehan/Desktop/Duke/21Spring/econ613_hw/A1")
